<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="I recently wrote about using first-class functions to help make a BF interpreter. This is a follow-up post to describe a nifty solution to a tricky problem that made my program go 5× faster and put it about on-par with an interpreter written in pure C.
A basic interpreter works by walking down the AST and evaluating nodes recursively: when the interpreter encounters an expression, it dispatches on the type of expression to decide how to perform the evaluation. Here&rsquo;s the key insight to get a massive speed bump with very little effort: that dispatch is expensive and can be performed ahead-of-time. We can walk through the code once and precompute all the dispatching work.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#eceff4">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#121519">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/posts/2024-09-27_threaded_interpreter/">
  <meta property="og:site_name" content="Lambda Land">
  <meta property="og:title" content="How to Make Racket Go As Fast As C">
  <meta property="og:description" content="I recently wrote about using first-class functions to help make a BF interpreter. This is a follow-up post to describe a nifty solution to a tricky problem that made my program go 5× faster and put it about on-par with an interpreter written in pure C.
A basic interpreter works by walking down the AST and evaluating nodes recursively: when the interpreter encounters an expression, it dispatches on the type of expression to decide how to perform the evaluation. Here’s the key insight to get a massive speed bump with very little effort: that dispatch is expensive and can be performed ahead-of-time. We can walk through the code once and precompute all the dispatching work.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-27T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-27T00:00:00+00:00">
    <meta property="article:tag" content="Racket">
    <meta property="article:tag" content="Programming">
<title>How to Make Racket Go As Fast As C | Lambda Land</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="stylesheet" href="/book.min.b677f4f10597447de28f8a022f5692b21788f21597d552934d82c1623a13ab65.css" integrity="sha256-tnf08QWXRH3ij4oCL1aSsheI8hWX1VKTTYLBYjoTq2U=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.b95952c3d7077077167e94bdaffa77ccc14357a8945a716ba117a960a68c0133.js" integrity="sha256-uVlSw9cHcHcWfpS9r/p3zMFDV6iUWnFroRepYKaMATM=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/img/lambda_logo.png" alt="Logo" /><span>Lambda Land</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/about/" class="">About</a>
  

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Technical Blog
      </a>
  </li>
  
  <li>
    <a href="/posts/personal/"  >
        Personal Blog
      </a>
  </li>
  
  <li>
    <a href="/#contact"  target="_blank" rel="noopener">
        Contact
      </a>
  </li>
  
  <li>
    <a href="/index.xml"  target="_blank" rel="noopener">
        RSS Feed
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 

        
        <hr />
        <div class="my-book-toc">
          <div class="my-book-toc-content">
            
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#an-basic-interpreter">An basic interpreter</a></li>
        <li><a href="#threading-the-environment">Threading the environment</a></li>
        <li><a href="#the-tricky-part-mutual-recursion">The tricky part: mutual recursion</a></li>
        <li><a href="#speed-boost">Speed boost</a></li>
        <li><a href="#appendix-full-code-for-basic-interpreter">Appendix: Full code for basic interpreter</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
          </div>
        </div>
        
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>How to Make Racket Go As Fast As C</strong>

  
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#an-basic-interpreter">An basic interpreter</a></li>
        <li><a href="#threading-the-environment">Threading the environment</a></li>
        <li><a href="#the-tricky-part-mutual-recursion">The tricky part: mutual recursion</a></li>
        <li><a href="#speed-boost">Speed boost</a></li>
        <li><a href="#appendix-full-code-for-basic-interpreter">Appendix: Full code for basic interpreter</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/2024-09-27_threaded_interpreter/">How to Make Racket Go As Fast As C</a>
  </h1>
  
  <h5>27 Sep 2024</h5>



  

  
  <div class="post-metadata-tags">
    
      <a href="/tags/racket/">Racket</a>, 
      <a href="/tags/programming/">Programming</a>
  </div>
  



<p>I recently wrote about <a href="/posts/2024-09-11_parameterized_decisions/">using first-class functions to help make a BF interpreter</a>. This is a follow-up post to describe a nifty solution to a tricky problem that made my program go 5× faster and put it about on-par with an interpreter written in pure C.</p>
<p>A basic interpreter works by walking down the AST and evaluating nodes recursively: when the interpreter encounters an expression, it dispatches on the type of expression to decide how to perform the evaluation. Here&rsquo;s the key insight to get a massive speed bump with very little effort: <em>that dispatch is expensive and can be performed ahead-of-time</em>. We can walk through the code <em>once</em> and precompute all the dispatching work.</p>
<p>This is not a new idea. The first description that I&rsquo;m aware of comes from Feeley and Lapalme [<a href="#citeproc_bib_item_1">1</a>]. A name for this technique is making a <em>threaded interpreter</em>. It&rsquo;s nowhere near as fast as a native code compiler, but interpreters are easy to write, and this is a very simple way to get a very big boost in performance.</p>
<h2 id="an-basic-interpreter">
  An basic interpreter
  <a class="anchor" href="#an-basic-interpreter">#</a>
</h2>
<div class="marginnote">
<p>Please see <a href="#appendix-full-code-for-basic-interpreter">the appendix</a> for the full code for this interpreter. Tested to run with Racket v8.14 [cs].</p>
</div>
<p>Here&rsquo;s a simple language and a (simplified) interpreter:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;; Syntax description</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> func <span style="color:#eceff4">(</span>params body<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> app <span style="color:#eceff4">(</span>fn-expr args<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> op <span style="color:#eceff4">(</span>op-name arg1 arg2<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> if-expr <span style="color:#eceff4">(</span>test-expr t-case f-case<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;; Closure values</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> closure <span style="color:#eceff4">(</span>params body env<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;; Core interpreter routine</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">define</span> <span style="color:#eceff4">(</span>interpret expr env<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">match</span> expr
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; Literal values: booleans and numbers evaluate to themselves</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span><span style="color:#81a1c1;font-weight:bold">or</span> <span style="color:#eceff4">(</span>? <span style="color:#81a1c1">number?</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>? <span style="color:#81a1c1">boolean?</span><span style="color:#eceff4">))</span> expr<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; Look up variables in the environment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>? <span style="color:#81a1c1">symbol?</span> var-name<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>lookup-env env var-name<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; Evaluating a function expression yields a closure value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>func params body<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>closure params body env<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; Application: evaluate the function expression to get a closure.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; Next, evaluate the arguments, and then extend the environment</span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; and evaluate the body of the closure.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>app fn-expr args<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">let</span> <span style="color:#eceff4">([</span>fn <span style="color:#eceff4">(</span>interpret fn-expr env<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>           <span style="color:#eceff4">[</span>eval-args <span style="color:#eceff4">(</span><span style="color:#81a1c1">map</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">λ</span> <span style="color:#eceff4">(</span>e<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>interpret e env<span style="color:#eceff4">))</span> args<span style="color:#eceff4">)])</span>
</span></span><span style="display:flex;"><span>       <span style="color:#eceff4">(</span>interpret <span style="color:#eceff4">(</span>closure-body fn<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#eceff4">(</span>extend-env env <span style="color:#eceff4">(</span>closure-params fn<span style="color:#eceff4">)</span> eval-args<span style="color:#eceff4">)))]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; Built-in operators</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>op op-name a1 a2<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">let</span> <span style="color:#eceff4">([</span>arg1 <span style="color:#eceff4">(</span>interpret a1 env<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>           <span style="color:#eceff4">[</span>arg2 <span style="color:#eceff4">(</span>interpret a2 env<span style="color:#eceff4">)])</span>
</span></span><span style="display:flex;"><span>       <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">case</span> op-name
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">+</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">+</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[</span><span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">error</span> <span style="color:#a3be8c">&#34;Undefined operator!&#34;</span><span style="color:#eceff4">)]))]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic">;; Conditionals</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>if-expr test tcase fcase<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span>interpret test env<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">(</span>interpret tcase env<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">(</span>interpret fcase env<span style="color:#eceff4">))]))</span><span style="color:#bf616a">
</span></span></span></code></pre></div><h2 id="threading-the-environment">
  Threading the environment
  <a class="anchor" href="#threading-the-environment">#</a>
</h2>
<h2 id="the-tricky-part-mutual-recursion">
  The tricky part: mutual recursion
  <a class="anchor" href="#the-tricky-part-mutual-recursion">#</a>
</h2>
<h2 id="speed-boost">
  Speed boost
  <a class="anchor" href="#speed-boost">#</a>
</h2>
<h2 id="appendix-full-code-for-basic-interpreter">
  Appendix: Full code for basic interpreter
  <a class="anchor" href="#appendix-full-code-for-basic-interpreter">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">#lang </span><span style="color:#8fbcbb">racket</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;; Syntax description</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> func <span style="color:#eceff4">(</span>params body<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> app <span style="color:#eceff4">(</span>fn-expr args<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> op <span style="color:#eceff4">(</span>op-name arg1 arg2<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> if-expr <span style="color:#eceff4">(</span>test-expr t-case f-case<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;; Closure values</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">struct</span> closure <span style="color:#eceff4">(</span>params body env<span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">#:transparent</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;; Environment helpers</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">define</span> <span style="color:#eceff4">(</span>extend-env base-env vars vals<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#81a1c1">foldl</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">λ</span> <span style="color:#eceff4">(</span>var val env-acc<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">cons</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">cons</span> var val<span style="color:#eceff4">)</span> env-acc<span style="color:#eceff4">))</span> base-env vars vals<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">define</span> <span style="color:#eceff4">(</span>lookup-env env var<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">match</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">assoc</span> var env<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span><span style="color:#81a1c1">cons</span> <span style="color:#81a1c1;font-weight:bold">_</span> val<span style="color:#eceff4">)</span> val<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[</span><span style="color:#8fbcbb">#f</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">error</span> <span style="color:#a3be8c">&#34;Undefined variable!&#34;</span><span style="color:#eceff4">)]))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic">;; Core interpreter routine</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">define</span> <span style="color:#eceff4">(</span>interpret expr env<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">match</span> expr
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span><span style="color:#81a1c1;font-weight:bold">or</span> <span style="color:#eceff4">(</span>? <span style="color:#81a1c1">number?</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>? <span style="color:#81a1c1">boolean?</span><span style="color:#eceff4">))</span> expr<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>? <span style="color:#81a1c1">symbol?</span> var-name<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>lookup-env env var-name<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>func params body<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>closure params body env<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>app fn-expr args<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">let</span> <span style="color:#eceff4">([</span>fn <span style="color:#eceff4">(</span>interpret fn-expr env<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>           <span style="color:#eceff4">[</span>eval-args <span style="color:#eceff4">(</span><span style="color:#81a1c1">map</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">λ</span> <span style="color:#eceff4">(</span>e<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>interpret e env<span style="color:#eceff4">))</span> args<span style="color:#eceff4">)])</span>
</span></span><span style="display:flex;"><span>       <span style="color:#eceff4">(</span>interpret <span style="color:#eceff4">(</span>closure-body fn<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>                  <span style="color:#eceff4">(</span>extend-env env <span style="color:#eceff4">(</span>closure-params fn<span style="color:#eceff4">)</span> eval-args<span style="color:#eceff4">)))]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>op op-name a1 a2<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">let</span> <span style="color:#eceff4">([</span>arg1 <span style="color:#eceff4">(</span>interpret a1 env<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>           <span style="color:#eceff4">[</span>arg2 <span style="color:#eceff4">(</span>interpret a2 env<span style="color:#eceff4">)])</span>
</span></span><span style="display:flex;"><span>       <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">case</span> op-name
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">+</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">+</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">-</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">*</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">*</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">/</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">/</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">&lt;</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">&lt;</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">&gt;</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">&gt;</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[(</span><span style="color:#81a1c1">=</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">=</span> arg1 arg2<span style="color:#eceff4">)]</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">[</span><span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">error</span> <span style="color:#a3be8c">&#34;Undefined operator!&#34;</span><span style="color:#eceff4">)]))]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span>if-expr test tcase fcase<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span>interpret test env<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">(</span>interpret tcase env<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>         <span style="color:#eceff4">(</span>interpret fcase env<span style="color:#eceff4">))]))</span><span style="color:#bf616a">
</span></span></span></code></pre></div><h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<style>.csl-left-margin{float: left; padding-right: 0em;}
 .csl-right-inline{margin: 0 0 0 1em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>
    <div class="csl-left-margin">[1]</div><div class="csl-right-inline">Feeley, M. and Lapalme, G. 1987. Using closures for code generation. <i>Computer languages</i>. 12, 1 (Jan. 1987), 47–66. DOI:<a href="https://doi.org/10.1016/0096-0551(87)90012-9">https://doi.org/10.1016/0096-0551(87)90012-9</a>.</div>
  </div>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        <script async src="/js/count.js"></script>
<script data-goatcounter="https://boink.lambdaland.org/count" async src="//boink.lambdaland.org/count.js"></script>
<a rel="me" style="display: none" href="https://fosstodon.org/@wiersdorf">Mastodon</a>
<div class="copyright-footer">
  <small>© Ashton Wiersdorf 2024</small>
</div>

      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

  </main>

  
</body>
</html>












