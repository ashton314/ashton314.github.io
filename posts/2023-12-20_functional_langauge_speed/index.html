<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Somewhere in my adolescence I got stuck with the notion that functional languages were slow while languages like C were fast. Now, a good C programmer can eke more performance out of their code than probably anyone else, but the cost you pay to keep your code correct goes exponential as you get closer and closer to the machine.
Functional languages abstract a lot away from the machine. Higher languages in general abstract away the machine and make code easier to maintain.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="https://lambdaland.org/posts/2023-12-20_functional_langauge_speed/">
  <meta property="og:site_name" content="Lambda Land">
  <meta property="og:title" content="Functional Languages Need Not Be Slow">
  <meta property="og:description" content="Somewhere in my adolescence I got stuck with the notion that functional languages were slow while languages like C were fast. Now, a good C programmer can eke more performance out of their code than probably anyone else, but the cost you pay to keep your code correct goes exponential as you get closer and closer to the machine.
Functional languages abstract a lot away from the machine. Higher languages in general abstract away the machine and make code easier to maintain.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-20T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-12-20T00:00:00+00:00">
    <meta property="article:tag" content="Programming-Languages">
<title>Functional Languages Need Not Be Slow | Lambda Land</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="stylesheet" href="/book.min.5958de6a99cbb0695de9351efb0d5803786fbc96402f36735a722aac688b2873.css" integrity="sha256-WVjeapnLsGld6TUe&#43;w1YA3hvvJZALzZzWnIqrGiLKHM=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.357f60623ccc6786962240e53c0a77c6233f459c03fd029b3cccea13e5afa7ea.js" integrity="sha256-NX9gYjzMZ4aWIkDlPAp3xiM/RZwD/QKbPMzqE&#43;Wvp&#43;o=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/img/lambda_logo.png" alt="Logo" /><span>Lambda Land</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>







  
<ul>
  
  <li>
    <a href="/resume.pdf"  target="_blank" rel="noopener">
        Résumé
      </a>
  </li>
  
  <li>
    <a href="/cv.pdf"  target="_blank" rel="noopener">
        Curriculum Vitae
      </a>
  </li>
  
</ul>







  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/about/" class="">About Me</a>
  

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Technical Blog
      </a>
  </li>
  
  <li>
    <a href="/posts/personal/"  >
        Personal Blog
      </a>
  </li>
  
  <li>
    <a href="#"  target="_blank" rel="noopener">
         
      </a>
  </li>
  
  <li>
    <a href="https://codeberg.org/ashton314"  target="_blank" rel="noopener">
        Codeberg
      </a>
  </li>
  
  <li>
    <a href="https://github.com/ashton314"  target="_blank" rel="noopener">
        GitHub
      </a>
  </li>
  
  <li>
    <a href="/#contact"  target="_blank" rel="noopener">
        Contact
      </a>
  </li>
  
  <li>
    <a href="/ashton_wiersdorf.pgp"  target="_blank" rel="noopener">
        PGP Key
      </a>
  </li>
  
  <li>
    <a href="/index.xml"  target="_blank" rel="noopener">
        RSS Feed
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Functional Languages Need Not Be Slow</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#the-programs">The programs</a></li>
        <li><a href="#the-results">The results</a></li>
        <li><a href="#discussion">Discussion</a></li>
        <li><a href="#bonus-building-the-graph-in-racket">Bonus: building the graph in Racket</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
<article class="markdown">
  <h1>
    <a href="/posts/2023-12-20_functional_langauge_speed/">Functional Languages Need Not Be Slow</a>
  </h1>
  
  <h5>20 Dec 2023</h5>



  

  
  <div class="post-metadata-tags">
    
      <a href="/tags/programming-languages/">Programming-Languages</a>
  </div>
  



<p>Somewhere in my adolescence I got stuck with the notion that functional languages were slow while languages like C were fast. Now, a good C programmer can eke more performance out of their code than probably anyone else, but the cost you pay to keep your code correct goes exponential as you get closer and closer to the machine.</p>
<p>Functional languages abstract a lot away from the machine. Higher languages in general abstract away the machine and make code easier to maintain. So I think I had it in my head that functional languages, being far away from the bare metal, must necessarily be slow. It didn&rsquo;t help that I also thought of functional languages as being necessarily interpreted languages.</p>
<p>Turns out, functional languages are just as amenable to compilation as imperative ones. Many popular/well-known functional are in fact compiled. (E.g. Haskell, Scala, Rust, Julia, etc.) Moreover, these languages can be just as fast—if not faster—than their more &ldquo;mainstream&rdquo; counterparts.</p>
<p>I wanted to pit my favorite language (Racket) against a <em>slightly</em> more well-known language (Python) to see how they handled a simple single-threaded program. For good measure I threw Rust, Julia, and JavaScript into the mix for comparison.</p>
<p>If you&rsquo;re impatient, just jump to <a href="#the-results">the results</a>.</p>
<h2 id="the-programs">
  The programs
  <a class="anchor" href="#the-programs">#</a>
</h2>
<p>I wrote the original program in Racket, then had ChatGPT help me rewrite it in Python. ChatGPT did astoundingly well. I eventually rewrote the program to be a little more idiomatic—I wanted it to use a loop instead of tail recursion, as Python is much better with loops than it is with lots and lots of function calls. I also had ChatGPT help me rewrite the program to Rust, Julia, and JavaScript. Impressive—and unsettling.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">#lang </span><span style="color:#8fbcbb">racket</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">define</span> <span style="color:#eceff4">(</span>count-collatz n <span style="color:#eceff4">[</span>cnt <span style="color:#b48ead">1</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">cond</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span><span style="color:#81a1c1">=</span> n <span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> cnt<span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[(</span><span style="color:#81a1c1">even?</span> n<span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span>count-collatz <span style="color:#eceff4">(</span><span style="color:#81a1c1">/</span> n <span style="color:#b48ead">2</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span> cnt<span style="color:#eceff4">))]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">[</span><span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">(</span>count-collatz <span style="color:#eceff4">(</span><span style="color:#81a1c1">+</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">*</span> <span style="color:#b48ead">3</span> n<span style="color:#eceff4">)</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span> cnt<span style="color:#eceff4">))]))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">define</span> <span style="color:#eceff4">(</span>count-collatz-upto n<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">for/fold</span>
</span></span><span style="display:flex;"><span>      <span style="color:#eceff4">([</span>max-seen <span style="color:#b48ead">0</span><span style="color:#eceff4">])</span>
</span></span><span style="display:flex;"><span>      <span style="color:#eceff4">([</span>i <span style="color:#eceff4">(</span><span style="color:#81a1c1">in-range</span> <span style="color:#b48ead">1</span> n<span style="color:#eceff4">)])</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">(</span><span style="color:#81a1c1">max</span> max-seen <span style="color:#eceff4">(</span>count-collatz i<span style="color:#eceff4">))))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1">displayln</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">format</span> <span style="color:#a3be8c">&#34;</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">Done ~a&#34;</span> <span style="color:#eceff4">(</span>count-collatz-upto <span style="color:#b48ead">5000000</span><span style="color:#eceff4">)))</span><span style="color:#bf616a">
</span></span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1:</span>
  <code>collatz_check.rkt</code>
</div>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">count_collatz</span><span style="color:#eceff4">(</span>n<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    cnt <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">while</span> n <span style="color:#81a1c1">!=</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">if</span> n <span style="color:#81a1c1">%</span> <span style="color:#b48ead">2</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            n <span style="color:#81a1c1">=</span> n <span style="color:#81a1c1">//</span> <span style="color:#b48ead">2</span>
</span></span><span style="display:flex;"><span>            cnt <span style="color:#81a1c1">+=</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">else</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            n <span style="color:#81a1c1">=</span> <span style="color:#b48ead">3</span> <span style="color:#81a1c1">*</span> n <span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>            cnt <span style="color:#81a1c1">+=</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> cnt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>max_seen <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">def</span> <span style="color:#88c0d0">count_collatz_upto</span><span style="color:#eceff4">(</span>n<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">global</span> max_seen
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#81a1c1">range</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span><span style="color:#eceff4">,</span> n<span style="color:#eceff4">):</span>
</span></span><span style="display:flex;"><span>        the_count <span style="color:#81a1c1">=</span> count_collatz<span style="color:#eceff4">(</span>i<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        max_seen <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">max</span><span style="color:#eceff4">(</span>max_seen<span style="color:#eceff4">,</span> the_count<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#b48ead">42</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>count_collatz_upto<span style="color:#eceff4">(</span><span style="color:#b48ead">5000000</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">Done&#34;</span><span style="color:#eceff4">,</span> max_seen<span style="color:#eceff4">)</span>
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 2:</span>
  <code>collatz_check.py</code>
</div>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">fn</span> <span style="color:#88c0d0">count_collatz</span><span style="color:#eceff4">(</span>n: <span style="color:#81a1c1">u64</span><span style="color:#eceff4">)</span> -&gt; <span style="color:#81a1c1">u64</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">let</span> <span style="color:#81a1c1;font-weight:bold">mut</span> cnt <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">let</span> <span style="color:#81a1c1;font-weight:bold">mut</span> num <span style="color:#81a1c1">=</span> n<span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">while</span> num <span style="color:#81a1c1">!=</span> <span style="color:#b48ead">1</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">if</span> num <span style="color:#81a1c1">%</span> <span style="color:#b48ead">2</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>            num <span style="color:#81a1c1">/=</span> <span style="color:#b48ead">2</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>            num <span style="color:#81a1c1">=</span> num <span style="color:#81a1c1">*</span> <span style="color:#b48ead">3</span> <span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>        cnt <span style="color:#81a1c1">+=</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    cnt
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">fn</span> <span style="color:#88c0d0">count_collatz_upto</span><span style="color:#eceff4">(</span>n: <span style="color:#81a1c1">u64</span><span style="color:#eceff4">)</span> -&gt; <span style="color:#81a1c1">u64</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">let</span> <span style="color:#81a1c1;font-weight:bold">mut</span> max_seen <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#b48ead">1</span><span style="color:#81a1c1">..</span>n <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        max_seen <span style="color:#81a1c1">=</span> max_seen<span style="color:#eceff4">.</span>max<span style="color:#eceff4">(</span>count_collatz<span style="color:#eceff4">(</span>i<span style="color:#eceff4">));</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    max_seen
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">fn</span> <span style="color:#88c0d0">main</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    println!<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Done </span><span style="color:#a3be8c">{}</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> count_collatz_upto<span style="color:#eceff4">(</span><span style="color:#b48ead">5000000</span><span style="color:#eceff4">));</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 3:</span>
  <code>collatz_check.rs</code>
</div>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-julia" data-lang="julia"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">function</span> count_collatz<span style="color:#eceff4">(</span>n<span style="color:#81a1c1">::</span><span style="color:#81a1c1">Int</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    cnt <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">while</span> n <span style="color:#81a1c1">!=</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">if</span> n <span style="color:#81a1c1">%</span> <span style="color:#b48ead">2</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span>            n <span style="color:#81a1c1">=</span> n <span style="color:#81a1c1">÷</span> <span style="color:#b48ead">2</span>
</span></span><span style="display:flex;"><span>            cnt <span style="color:#81a1c1">+=</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>            n <span style="color:#81a1c1">=</span> <span style="color:#b48ead">3</span> <span style="color:#81a1c1">*</span> n <span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>            cnt <span style="color:#81a1c1">+=</span> <span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> cnt
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>max_seen <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">function</span> count_collatz_upto<span style="color:#eceff4">(</span>n<span style="color:#81a1c1">::</span><span style="color:#81a1c1">Int</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">for</span> i <span style="color:#81a1c1;font-weight:bold">in</span> <span style="color:#b48ead">1</span><span style="color:#81a1c1">:</span>n<span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span>
</span></span><span style="display:flex;"><span>        the_count <span style="color:#81a1c1">=</span> count_collatz<span style="color:#eceff4">(</span>i<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">global</span> max_seen <span style="color:#81a1c1">=</span> max<span style="color:#eceff4">(</span>max_seen<span style="color:#eceff4">,</span> the_count<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#b48ead">42</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>count_collatz_upto<span style="color:#eceff4">(</span><span style="color:#b48ead">5000000</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>println<span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">Done &#34;</span><span style="color:#eceff4">,</span> max_seen<span style="color:#eceff4">)</span>
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 4:</span>
  <code>collatz_check.jl</code>
</div>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">function</span> countCollatz<span style="color:#eceff4">(</span>n<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">let</span> cnt <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">while</span> <span style="color:#eceff4">(</span>n <span style="color:#81a1c1">!==</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span>n <span style="color:#81a1c1">%</span> <span style="color:#b48ead">2</span> <span style="color:#81a1c1">===</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>      n <span style="color:#81a1c1">=</span> n <span style="color:#81a1c1">/</span> <span style="color:#b48ead">2</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>      n <span style="color:#81a1c1">=</span> <span style="color:#b48ead">3</span> <span style="color:#81a1c1">*</span> n <span style="color:#81a1c1">+</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    cnt<span style="color:#81a1c1">++</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">return</span> cnt<span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">function</span> countCollatzUpto<span style="color:#eceff4">(</span>n<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">let</span> maxSeen <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">for</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">let</span> i <span style="color:#81a1c1">=</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">;</span> i <span style="color:#81a1c1">&lt;</span> n<span style="color:#eceff4">;</span> i<span style="color:#81a1c1">++</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    maxSeen <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">Math</span><span style="color:#eceff4">.</span>max<span style="color:#eceff4">(</span>maxSeen<span style="color:#eceff4">,</span> countCollatz<span style="color:#eceff4">(</span>i<span style="color:#eceff4">));</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#81a1c1;font-weight:bold">return</span> maxSeen<span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>console<span style="color:#eceff4">.</span>log<span style="color:#eceff4">(</span><span style="color:#a3be8c">`\nDone </span><span style="color:#a3be8c">${</span>countCollatzUpto<span style="color:#eceff4">(</span><span style="color:#b48ead">5000000</span><span style="color:#eceff4">)</span><span style="color:#a3be8c">}</span><span style="color:#a3be8c">`</span><span style="color:#eceff4">);</span>
</span></span></code></pre></div><div class="src-block-caption">
  <span class="src-block-number">Code Snippet 5:</span>
  <code>collatz_check.js</code>
</div>
<h2 id="the-results">
  The results
  <a class="anchor" href="#the-results">#</a>
</h2>
<p>I ran these programs on my M1 Pro MacBook Pro. Here&rsquo;s what I got:</p>
<style>.table-nocaption table { text-align: right;  }</style>
<div class="ox-hugo-table table-nocaption">
<table>
<thead>
<tr>
<th>Language</th>
<th>Time (seconds)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Racket</td>
<td>4.68</td>
</tr>
<tr>
<td>Python</td>
<td>34.27</td>
</tr>
<tr>
<td>Rust</td>
<td>3.03</td>
</tr>
<tr>
<td>Julia</td>
<td>2.34</td>
</tr>
<tr>
<td>JavaScript</td>
<td>11.92</td>
</tr>
</tbody>
</table>
</div>
<p>In graphical form:</p>
<figure><img src="/img/benchmark_shootout.svg">
</figure>

<p>Wow! I did not expect Python to get so pummeled by everything else! It makes sense that Julia with its sweet JIT engine is the fastest. Rust does well—no surprise there. (Note that I&rsquo;m not counting compilation time here—all the more impressive for Julia!) Racket holds its own though, coming in third place by a wide margin. If you did take Rust&rsquo;s compile time into account, I think that would make it switch places with Racket. Of course, you use Rust for compile-once-run-lots sorts of scenarios.</p>
<h2 id="discussion">
  Discussion
  <a class="anchor" href="#discussion">#</a>
</h2>
<p>Are these authoritative? No, of course not. This is a simple synthetic benchmark. I don&rsquo;t consider myself expert programmer in <em>any</em> of these languages, so there are likely some performance tweaks that could make the respective language&rsquo;s benchmark run faster. (Maybe I should in Racket… it&rsquo;s kind of hard to consider yourself an expert in a language when its creator works down the hall from you though.)</p>
<p>That said, I hope this dispels the myth that functional languages are <em>necessarily</em> slow. That is not the case. If Python is fast enough for your use-case, then there&rsquo;s no reason you shouldn&rsquo;t consider using Racket on performance grounds.</p>
<p>Library support is a different matter: of all the programming that goes on in the world, the majority is probably just gluing libraries together to do the thing you want. This is a good thing: it means we&rsquo;re not reinventing so many wheels and people are getting good work done.</p>
<p>That said, there&rsquo;s plenty of exciting work for which no library exists! If you find yourself in one of these exciting cases, consider using the tool of maximum power: in this regard, nothing beats Racket for its flexibility and <a href="/posts/2023-10-17_fearless_macros/">extensibility</a>.</p>
<h2 id="bonus-building-the-graph-in-racket">
  Bonus: building the graph in Racket
  <a class="anchor" href="#bonus-building-the-graph-in-racket">#</a>
</h2>
<p>I love the Racket <a href="https://docs.racket-lang.org/plot/">Plot</a> library. So easy to use, so powerful. If you run it inside of DrRacket, the graphs are actually interactive: you can rotate 3D graphs and zoom in on sections of 2D graphs. So neat!</p>
<p>Here&rsquo;s the code I used to generate the above graph:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-racket" data-lang="racket"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">#lang </span><span style="color:#8fbcbb">racket</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">require</span> plot<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">define</span> *data* <span style="color:#eceff4">(</span><span style="color:#81a1c1">list</span> <span style="color:#81a1c1">#</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Racket&#34;</span> <span style="color:#b48ead">4.68</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">#</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Python&#34;</span> <span style="color:#b48ead">34.27</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">#</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Rust&#34;</span> <span style="color:#b48ead">3.03</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">#</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;Julia&#34;</span> <span style="color:#b48ead">2.34</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">#</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;JavaScript&#34;</span> <span style="color:#b48ead">11.92</span><span style="color:#eceff4">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">parameterize</span> <span style="color:#eceff4">([</span>plot-font-face <span style="color:#a3be8c">&#34;Charter&#34;</span><span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>               <span style="color:#eceff4">[</span>plot-font-size <span style="color:#b48ead">14.0</span><span style="color:#eceff4">]</span>
</span></span><span style="display:flex;"><span>               <span style="color:#eceff4">[</span>plot-x-ticks <span style="color:#eceff4">(</span>linear-ticks <span style="color:#81a1c1;font-weight:bold">#:number</span> <span style="color:#b48ead">10</span> <span style="color:#81a1c1;font-weight:bold">#:divisors</span> <span style="color:#81a1c1">&#39;</span><span style="color:#eceff4">(</span><span style="color:#b48ead">1</span> <span style="color:#b48ead">2</span> <span style="color:#b48ead">5</span><span style="color:#eceff4">))])</span>
</span></span><span style="display:flex;"><span>  <span style="color:#eceff4">(</span>plot <span style="color:#eceff4">(</span><span style="color:#81a1c1">list</span> <span style="color:#eceff4">(</span>discrete-histogram <span style="color:#eceff4">(</span><span style="color:#81a1c1">reverse</span> *data*<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>                                  <span style="color:#81a1c1;font-weight:bold">#:gap</span> <span style="color:#b48ead">0.3</span>
</span></span><span style="display:flex;"><span>                                  <span style="color:#81a1c1;font-weight:bold">#:invert?</span> <span style="color:#8fbcbb">#true</span><span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">#:title</span> <span style="color:#a3be8c">&#34;Simple benchmark results&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">#:out-kind</span> <span style="color:#81a1c1">&#39;</span><span style="color:#a3be8c">svg</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">#:out-file</span> <span style="color:#a3be8c">&#34;benchmark_shootout.svg&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">#:x-max</span> <span style="color:#b48ead">35</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">#:x-label</span> <span style="color:#a3be8c">&#34;Seconds&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">#:width</span> <span style="color:#b48ead">800</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">#:height</span> <span style="color:#b48ead">200</span><span style="color:#eceff4">))</span><span style="color:#bf616a">
</span></span></span></code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        <script src="/js/count.js"></script>
<a rel="me" style="display: none" href="https://fosstodon.org/@wiersdorf">Mastodon</a>
<div class="copyright-footer">
  <small>© Ashton Wiersdorf 2024</small>
</div>

      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#the-programs">The programs</a></li>
        <li><a href="#the-results">The results</a></li>
        <li><a href="#discussion">Discussion</a></li>
        <li><a href="#bonus-building-the-graph-in-racket">Bonus: building the graph in Racket</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












